### Single Table to hold 835 Payment EDI files and summary information
CREATE TABLE payments_835 (
    id SERIAL PRIMARY KEY,
    file_id UUID NOT NULL DEFAULT gen_random_uuid(),
    file_name TEXT,
    received_at TIMESTAMP,
    check_number TEXT,
    payment_date DATE,
    payment_amount NUMERIC(12,2),
    payer_id TEXT,
    payee_id TEXT,
    json_transaction JSONB NOT NULL,          
    raw_edi TEXT,                     
    created_at TIMESTAMP DEFAULT now(),
);


###********************************************************************************************************
### Normalized Tables for detailed 835 EDI data storage
###  Raw Files
CREATE TABLE raw_835_files (
    id SERIAL PRIMARY KEY,
    file_id UUID NOT NULL DEFAULT gen_random_uuid(),
    received_at TIMESTAMP DEFAULT now(),
    raw_edi TEXT NOT NULL
    json_transaction JSONB NOT NULL,
    created_at TIMESTAMP DEFAULT now()
);


###  Transactions (BPR/TRN level)
CREATE TABLE transactions (
    id SERIAL PRIMARY KEY,
    raw_file_id INT REFERENCES raw_835_files(id) ON DELETE CASCADE,
    trace_number TEXT,
    payment_method TEXT,
    payment_amount NUMERIC(12,2),
    payment_date DATE,
    payer_id TEXT,
    payee_id TEXT,
    json_TR JSONB NOT NULL,

);

###  Claims (CLP level)
CREATE TABLE claims (
    id SERIAL PRIMARY KEY,
    transaction_id INT REFERENCES transactions(id) ON DELETE CASCADE,
    claim_number TEXT,
    patient_control_number TEXT,
    claim_amount NUMERIC(12,2),
    paid_amount NUMERIC(12,2),
    status_code TEXT,
    json_CLM JSONB,
    posted_at TIMESTAMP,
    source_system_claim_id TEXT
);

###  Service Lines (SVC + CAS level)

CREATE TABLE service_lines (
    id SERIAL PRIMARY KEY,
    claim_id INT REFERENCES claims(id) ON DELETE CASCADE,
    procedure_code TEXT,
    charge_amount NUMERIC(12,2),
    paid_amount NUMERIC(12,2),
    adjustment_reason_codes JSONB,
    json_SVC JSONB NOT NULL,
    posted_at TIMESTAMP,
    source_system_line_id TEXT
);
